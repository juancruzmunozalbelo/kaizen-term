<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description"
    content="KaizenTerm â€” Distraction-free terminal workspace for focused multi-agent vibe coding with Kaizen methodology" />
  <title>KaizenTerm</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@300;400;500;600&display=swap"
    rel="stylesheet">
</head>

<body>
  <!-- AI Loading Overlay -->
  <div id="ai-loading-overlay">
    <div class="ai-loading-card">
      <div class="ai-loading-logo">
        <svg viewBox="0 0 60 60" width="56" height="56">
          <defs>
            <linearGradient id="load-grad" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" style="stop-color:#00e5ff" />
              <stop offset="100%" style="stop-color:#ff006e" />
            </linearGradient>
          </defs>
          <circle cx="30" cy="30" r="24" fill="none" stroke="url(#load-grad)" stroke-width="3" stroke-dasharray="120 30"
            stroke-linecap="round" class="ai-loading-ring" />
          <text x="50%" y="54%" dominant-baseline="middle" text-anchor="middle" font-size="22"
            fill="url(#load-grad)">âš¡</text>
        </svg>
      </div>
      <h2 class="ai-loading-title">KaizenTerm</h2>
      <p id="ai-loading-status" class="ai-loading-status">Starting AI model...</p>
      <div class="ai-loading-dots">
        <span></span><span></span><span></span>
      </div>
    </div>
  </div>
  <div id="app">
    <!-- Top Bar -->
    <header id="top-bar">
      <div class="top-bar-left">
        <div class="logo" id="logo">
          <svg viewBox="0 0 40 40" width="28" height="28">
            <circle cx="20" cy="20" r="16" fill="none" stroke="url(#enso-grad)" stroke-width="2.5"
              stroke-dasharray="90 10" stroke-linecap="round" />
            <defs>
              <linearGradient id="enso-grad" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" stop-color="#00e5ff" />
                <stop offset="100%" stop-color="#ff006e" />
              </linearGradient>
            </defs>
          </svg>
          <span class="logo-text">KaizenTerm</span>
        </div>
        <nav class="layout-controls">
          <button class="layout-btn active" data-layout="1" title="Single pane">
            <svg viewBox="0 0 16 16" width="14" height="14">
              <rect x="1" y="1" width="14" height="14" rx="2" fill="none" stroke="currentColor" stroke-width="1.5" />
            </svg>
          </button>
          <button class="layout-btn" data-layout="2" title="Two panes">
            <svg viewBox="0 0 16 16" width="14" height="14">
              <rect x="1" y="1" width="6" height="14" rx="1" fill="none" stroke="currentColor" stroke-width="1.5" />
              <rect x="9" y="1" width="6" height="14" rx="1" fill="none" stroke="currentColor" stroke-width="1.5" />
            </svg>
          </button>
          <button class="layout-btn" data-layout="3" title="Main + Sides">
            <svg viewBox="0 0 16 16" width="14" height="14">
              <rect x="1" y="1" width="9" height="14" rx="1" fill="none" stroke="currentColor" stroke-width="1.5" />
              <rect x="11.5" y="1" width="3.5" height="6" rx="1" fill="none" stroke="currentColor" stroke-width="1.2" />
              <rect x="11.5" y="9" width="3.5" height="6" rx="1" fill="none" stroke="currentColor" stroke-width="1.2" />
            </svg>
          </button>
          <button class="layout-btn" data-layout="4" title="Four panes">
            <svg viewBox="0 0 16 16" width="14" height="14">
              <rect x="1" y="1" width="6" height="6" rx="1" fill="none" stroke="currentColor" stroke-width="1.5" />
              <rect x="9" y="1" width="6" height="6" rx="1" fill="none" stroke="currentColor" stroke-width="1.5" />
              <rect x="1" y="9" width="6" height="6" rx="1" fill="none" stroke="currentColor" stroke-width="1.5" />
              <rect x="9" y="9" width="6" height="6" rx="1" fill="none" stroke="currentColor" stroke-width="1.5" />
            </svg>
          </button>
          <button class="layout-btn" data-layout="6" title="Six panes">
            <svg viewBox="0 0 16 16" width="14" height="14">
              <rect x="1" y="1" width="4" height="6" rx="1" fill="none" stroke="currentColor" stroke-width="1.2" />
              <rect x="6" y="1" width="4" height="6" rx="1" fill="none" stroke="currentColor" stroke-width="1.2" />
              <rect x="11" y="1" width="4" height="6" rx="1" fill="none" stroke="currentColor" stroke-width="1.2" />
              <rect x="1" y="9" width="4" height="6" rx="1" fill="none" stroke="currentColor" stroke-width="1.2" />
              <rect x="6" y="9" width="4" height="6" rx="1" fill="none" stroke="currentColor" stroke-width="1.2" />
              <rect x="11" y="9" width="4" height="6" rx="1" fill="none" stroke="currentColor" stroke-width="1.2" />
            </svg>
          </button>
        </nav>
        <button id="tools-toggle" class="action-btn tools-btn" title="Tools & MCP (Ctrl+T)">
          <span class="btn-icon">ğŸ”§</span> Tools
        </button>
      </div>
      <div class="top-bar-center">
        <button id="add-agent-btn" class="action-btn" title="Add Agent (Ctrl+N)">
          <span class="btn-icon">+</span> New Agent
        </button>
        <button id="zen-mode-btn" class="action-btn zen" title="Zen Mode (Ctrl+Shift+Z)">
          <span class="btn-icon">â—</span> Zen
        </button>
        <button id="cmd-palette-btn" class="action-btn" title="Command Palette (Ctrl+K)">
          <span class="btn-icon">âŒ˜</span> <span class="shortcut">Ctrl+K</span>
        </button>
      </div>
      <div class="top-bar-right">
        <div id="focus-timer" class="timer-display">
          <button id="timer-toggle" class="timer-btn" title="Start/Stop Timer">â–¶</button>
          <span id="timer-value">25:00</span>
          <span id="timer-cycles" class="timer-cycles">0 cycles</span>
        </div>
        <button id="kanban-toggle" class="action-btn kanban-btn" title="Toggle Kanban (Ctrl+B)">
          <span class="btn-icon">â˜°</span> Kanban
        </button>
      </div>
    </header>

    <!-- Main Content -->
    <main id="workspace">
      <!-- Skills / MCP Sidebar (Left) -->
      <aside id="tools-sidebar" class="tools-sidebar hidden">
        <div class="tools-header">
          <h2>Tools</h2>
          <button id="tools-close" class="close-btn">âœ•</button>
        </div>

        <div class="tools-section" id="scan-paths-section">
          <div class="tools-section-header">
            <span class="tools-section-icon">ğŸ“‚</span>
            <h3>Scan Paths</h3>
            <button id="add-scan-path" class="tools-refresh-btn" title="Add Folder">ï¼‹</button>
          </div>
          <div class="tools-list" id="scan-paths-list"></div>
        </div>

        <div class="tools-section" id="mcp-section">
          <div class="tools-section-header">
            <span class="tools-section-icon">ğŸ”Œ</span>
            <h3>MCP Servers</h3>
            <button id="mcp-refresh" class="tools-refresh-btn" title="Refresh">âŸ²</button>
          </div>
          <div class="tools-list" id="mcp-list">
            <div class="tools-empty">Scanning...</div>
          </div>
        </div>

        <div class="tools-section" id="skills-section">
          <div class="tools-section-header">
            <span class="tools-section-icon">ğŸ”§</span>
            <h3>Skills</h3>
            <button id="skills-refresh" class="tools-refresh-btn" title="Refresh">âŸ²</button>
          </div>
          <div class="tools-list" id="skills-list">
            <div class="tools-empty">Scanning...</div>
          </div>
        </div>

        <div class="tools-section" id="workflows-section">
          <div class="tools-section-header">
            <span class="tools-section-icon">ğŸ“‹</span>
            <h3>Workflows</h3>
          </div>
          <div class="tools-list" id="workflows-list">
            <div class="tools-empty">Scanning...</div>
          </div>
        </div>
      </aside>

      <!-- Agent Nav Tabs (Fix 8) -->
      <div id="agent-tabs"></div>

      <!-- Terminal Grid -->
      <section id="terminal-grid" class="terminal-grid layout-1">
        <!-- Terminals injected by JS -->
      </section>

      <!-- Kanban Sidebar -->
      <aside id="kanban-sidebar" class="kanban-sidebar hidden">
        <div class="kanban-header">
          <h2>Kaizen Board</h2>
          <button id="kanban-close" class="close-btn">âœ•</button>
        </div>
        <!-- Task Detail Drawer (Fix 4) -->
        <div id="task-detail-drawer" class="task-detail-drawer hidden">
          <div class="task-detail-header">
            <button id="task-detail-close" class="task-detail-close" title="Close">â† Back</button>
          </div>
          <div class="task-detail-body">
            <input id="task-detail-title" class="task-detail-title" placeholder="Task title" />
            <textarea id="task-detail-desc" class="task-detail-desc" placeholder="Add a description..."></textarea>
            <div class="task-detail-meta">
              <div class="task-detail-field">
                <label>Status</label>
                <select id="task-detail-status">
                  <option value="backlog">Backlog</option>
                  <option value="doing">In Progress</option>
                  <option value="review">Review</option>
                  <option value="done">Done</option>
                </select>
              </div>
              <div class="task-detail-field">
                <label>Priority</label>
                <select id="task-detail-priority">
                  <option value="low">Low</option>
                  <option value="medium">Medium</option>
                  <option value="high">High</option>
                  <option value="critical">Critical</option>
                </select>
              </div>
              <div class="task-detail-field">
                <label>Jira</label>
                <span id="task-detail-jira" class="task-detail-jira-key">â€”</span>
              </div>
            </div>
            <button id="task-detail-spawn" class="task-detail-spawn-btn">âš¡ Spawn Agent for this Task</button>
          </div>
        </div>
        <div class="kanban-columns">
          <div class="kanban-column" data-status="backlog">
            <div class="column-header">
              <span class="column-dot backlog"></span>
              <h3>Backlog</h3>
              <span class="column-count" style="display:none">0</span>
              <button class="add-task-btn" data-status="backlog" title="Add task">+</button>
            </div>
            <div class="column-tasks" data-status="backlog"></div>
          </div>
          <div class="kanban-column" data-status="doing">
            <div class="column-header">
              <span class="column-dot doing"></span>
              <h3>In Progress</h3>
              <span class="column-count" style="display:none">0</span>
              <button class="add-task-btn" data-status="doing" title="Add task">+</button>
            </div>
            <div class="column-tasks" data-status="doing"></div>
          </div>
          <div class="kanban-column" data-status="review">
            <div class="column-header">
              <span class="column-dot review"></span>
              <h3>Review</h3>
              <span class="column-count" style="display:none">0</span>
              <button class="add-task-btn" data-status="review" title="Add task">+</button>
            </div>
            <div class="column-tasks" data-status="review"></div>
          </div>
          <div class="kanban-column" data-status="done">
            <div class="column-header">
              <span class="column-dot done"></span>
              <h3>Done</h3>
              <span class="column-count" style="display:none">0</span>
              <button class="add-task-btn" data-status="done" title="Add task">+</button>
            </div>
            <div class="column-tasks" data-status="done"></div>
          </div>
        </div>
      </aside>
    </main>

    <!-- Command Palette Overlay -->
    <div id="command-palette" class="command-palette hidden">
      <div class="palette-backdrop"></div>
      <div class="palette-dialog">
        <input type="text" id="palette-input" class="palette-input" placeholder="Type a command..."
          autocomplete="off" />
        <ul id="palette-results" class="palette-results"></ul>
      </div>
    </div>

    <!-- Status Bar -->
    <footer id="status-bar">
      <span id="status-agents" class="status-item">0 agents</span>
      <span class="status-separator">â”‚</span>
      <span id="status-layout" class="status-item">1Ã—1</span>
      <span class="status-separator">â”‚</span>
      <span id="status-tasks" class="status-item">0 tasks</span>
      <span class="status-separator">â”‚</span>
      <span id="status-ai" class="status-item status-ai-badge" title="AI Provider (click to configure)"
        style="cursor:pointer">ğŸ¤– none</span>
      <span class="status-separator">â”‚</span>
      <span id="status-git" class="status-item" title="Git branch"></span>
      <span class="status-spacer"></span>
      <!-- Alert History Bell -->
      <span id="alert-bell" class="status-item alert-bell" title="Alert History">
        ğŸ””<span id="alert-badge" class="alert-badge hidden">0</span>
      </span>
      <div id="alert-history-panel" class="alert-history-panel hidden">
        <div class="alert-history-header">
          <span>ğŸ”” Alert History</span>
          <button id="alert-clear" class="alert-clear-btn">Clear</button>
        </div>
        <div id="alert-history-list" class="alert-history-list">
          <div class="alert-empty">No alerts yet</div>
        </div>
      </div>
      <span class="status-separator">â”‚</span>
      <span id="status-session" class="status-item">Session: --:--</span>
      <span class="status-separator">â”‚</span>
      <span class="status-item kaizen-quote" id="kaizen-quote">æ”¹å–„ â€” Continuous Improvement</span>
    </footer>

    <!-- Omni-Agent Drawer (Feature 5) -->
    <aside id="omni-agent-drawer" class="omni-drawer hidden">
      <div class="omni-header">
        <span class="omni-title">ğŸ¤– Agent Chat</span>
        <button id="omni-close" class="omni-close-btn" title="Close">âœ•</button>
      </div>
      <div id="omni-messages" class="omni-messages">
        <div class="omni-welcome">
          <span class="omni-welcome-icon">ğŸ§ </span>
          <p>Type a prompt below. It will be sent to the <strong>active terminal</strong> as input, or to an MCP agent
            if configured.</p>
        </div>
      </div>
      <div class="omni-input-area">
        <textarea id="omni-input" class="omni-input" placeholder="Ask anything... (sent to active terminal)"
          rows="2"></textarea>
        <div class="omni-actions">
          <button id="omni-send-ai" class="omni-btn ai" title="Ask AI (Ollama)">ğŸ¤– AI</button>
          <button id="omni-send-mcp" class="omni-btn" title="Send with terminal context">ğŸ”Œ MCP</button>
          <button id="omni-send-terminal" class="omni-btn send" title="Send to active terminal">â Terminal</button>
        </div>
      </div>
    </aside>
  </div>

  <!-- Phase 10: First-Run Onboarding -->
  <div id="onboarding-overlay" class="onboarding-overlay hidden">
    <div class="onboarding-card">
      <div class="onboarding-step active" data-step="0">
        <div class="onboarding-icon">âš¡</div>
        <h2>Welcome to KaizenTerm</h2>
        <p>The <strong>Terminal Orchestration Cockpit</strong> â€” where developers command fleets, not type commands.</p>
        <div class="onboarding-pipeline">
          ğŸ“‹ Kanban Task â†’ âš¡ Spawn Agent â†’ ğŸ¤– AI Executes â†’ ğŸ‘ Watch Mode â†’ âœ… Done
        </div>
        <p class="onboarding-sub">4 parallel agents Â· Built-in AI Â· Kanban board Â· MCP tools Â· All in one terminal.</p>
      </div>
      <div class="onboarding-step" data-step="1">
        <div class="onboarding-icon">ğŸ¤–</div>
        <h2>AI-Powered Terminal</h2>
        <p>Type <code>#</code> in any terminal to talk to your AI assistant:</p>
        <div class="onboarding-code"># list all running docker containers sorted by memory<br><span
            class="onboarding-result">â†’ docker stats --no-stream --format "table {{.Name}}\t{{.MemUsage}}" | sort -k2
            -hr</span></div>
        <p class="onboarding-sub">AI translates natural language â†’ shell commands. You review, it executes.</p>
      </div>
      <div class="onboarding-step" data-step="2">
        <div class="onboarding-icon">ğŸ“¡</div>
        <h2>Multi-Agent Swarm</h2>
        <p>Run <strong>4 agents in parallel</strong>, each in their own directory. Combine with:</p>
        <div class="onboarding-code">
          <strong>ğŸ“‹ Kanban Board</strong> â€” Drag tasks from Backlog â†’ Doing â†’ Done<br>
          <strong>ğŸ‘ Watch Mode</strong> â€” Click ğŸ‘ on any agent to get notified on errors<br>
          <strong>ğŸ“¡ Broadcast</strong> â€” Send the same command to all agents at once<br>
          <strong>ğŸ§° MCP + Skills</strong> â€” Connect Jira, filesystem, and custom tools
        </div>
        <p class="onboarding-sub">Each agent monitors its own output, detects errors, and alerts you.</p>
      </div>
      <div class="onboarding-step" data-step="3">
        <div class="onboarding-icon">ğŸš€</div>
        <h2>You're ready!</h2>
        <p>Open the <strong>Kanban board</strong> (âŒ˜B), create a task, and hit âš¡ to spawn your first agent.</p>
        <div class="onboarding-shortcuts">
          <span><kbd>âŒ˜K</kbd> Command Palette</span>
          <span><kbd>#</kbd> AI Chat</span>
          <span><kbd>âŒ˜1-4</kbd> Switch Agent</span>
          <span><kbd>ğŸ‘</kbd> Watch Mode</span>
        </div>
      </div>
      <div class="onboarding-nav">
        <div class="onboarding-dots">
          <span class="dot active" data-dot="0"></span>
          <span class="dot" data-dot="1"></span>
          <span class="dot" data-dot="2"></span>
          <span class="dot" data-dot="3"></span>
        </div>
        <div class="onboarding-actions">
          <label class="onboarding-hide-label"
            style="display:flex;align-items:center;gap:6px;font-size:12px;color:rgba(232,232,240,0.4);cursor:pointer;">
            <input type="checkbox" id="onboarding-hide-check" style="accent-color:#00e5ff;cursor:pointer;" />
            Don't show again
          </label>
          <button id="onboarding-skip" class="onboarding-skip-btn"
            style="background:none;border:none;color:rgba(232,232,240,0.4);font-size:12px;cursor:pointer;text-decoration:underline;">Skip</button>
          <button id="onboarding-next" class="onboarding-btn">Next â†’</button>
        </div>
      </div>
    </div>
  </div>

  <script type="module" src="/src/main.ts"></script>
</body>

</html>